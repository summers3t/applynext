import"../chunks/Bzak7iHL.js";import"../chunks/CYsr-paj.js";import{o as ue}from"../chunks/C96VhvSi.js";import{p as pe,a9 as W,aa as me,f as d,a as q,b as p,c as _e,i as ce,m as fe,s as t,d as r,a7 as de,u as f,r as i,j as y,t as w,ab as X,e as ge}from"../chunks/BAKKtip-.js";import{e as G,s as be}from"../chunks/C9sUR3Xw.js";import{i as P}from"../chunks/B8FQCOyo.js";import{s as he}from"../chunks/7JXNQEVd.js";import{r as ye,b as we}from"../chunks/fZbFrnr1.js";import{b as Y}from"../chunks/CbCBvXji.js";import{i as ke}from"../chunks/VeT9vhzU.js";import{p as xe}from"../chunks/Bi-hDZpV.js";import{s as je,a as k,b as m}from"../chunks/DrU4zZF5.js";/* empty css                */import{s as x}from"../chunks/Dew1yWqH.js";import{s as Fe}from"../chunks/DIGPD2v9.js";import{g as C}from"../chunks/DXZnKqI-.js";import{p as M}from"../chunks/B-whpyTF.js";import{s as T,d as U,a as z}from"../chunks/DnaHdphz.js";var Ae=d('<div class="center"><div class="task-filters" style="display:flex; gap:1em; align-items:center; margin-bottom:1.5em;"><label>Status: <select><option>All</option><option>Open</option><option>In Progress</option><option>Done</option></select></label> <label>Due: <select><option>All</option><option>Overdue</option><option>Today</option><option>Upcoming</option><option>No Due Date</option></select></label> <input type="text" placeholder="Search tasksâ€¦" style="min-width: 12em;"/> <button style="margin-left:1em;" class="svelte-m8an6f">Clear filters</button></div></div>'),$e=d('<span style="margin-right:1em;"> </span> <button class="svelte-m8an6f">Log out</button>',1),De=d('<button class="svelte-m8an6f">Log in with Google</button>'),Le=d('<div class="welcome svelte-m8an6f"><h2>Welcome to ApplyNext</h2> <p>Sign in with Google to start managing your projects.</p></div>'),Oe=d('<div class="top-bar svelte-m8an6f"><div class="left svelte-m8an6f"><b>ApplyNext</b></div> <!> <div class="right svelte-m8an6f"><!></div></div> <!>',1);function Re(Z,j){pe(j,!1);const[g,ee]=je(),o=()=>k(Fe,"$session",g),b=()=>k(T,"$statusFilter",g),h=()=>k(U,"$dueFilter",g),F=()=>k(z,"$searchQuery",g),_=fe();xe(j,"data",8);async function B(){var s,l,n,u;if(!((l=(s=y(_))==null?void 0:s.user)!=null&&l.email)||!((u=(n=y(_))==null?void 0:n.user)!=null&&u.id))return;const{data:e,error:a}=await x.from("project_users").select("id").eq("invited_email",y(_).user.email).is("user_id",null);a||!e||e.length===0||await Promise.all(e.map(c=>x.from("project_users").update({user_id:y(_).user.id,invited_email:null,status:"active"}).eq("id",c.id)))}async function ae(){const{error:e}=await x.auth.signInWithOAuth({provider:"google"});e&&alert("Login error: "+e.message)}async function te(){await x.auth.signOut(),C("/")}ue(()=>{var e;(e=o())!=null&&e.user&&B()}),W(()=>o(),()=>{ce(_,o())}),W(()=>o(),()=>{var e;(e=o())!=null&&e.user&&B()}),W(()=>(o(),C),()=>{var e;(e=o())!=null&&e.user&&M.url.pathname==="/"&&C("/projects")}),me(),ke();var E=Oe(),A=q(E),H=t(r(A),2);{var oe=e=>{var a=Ae(),s=r(a),l=r(s),n=t(r(l));w(()=>{b(),X(()=>{})});var u=r(n);u.value=u.__value="all";var c=t(u);c.value=c.__value="open";var $=t(c);$.value=$.__value="in_progress";var K=t($);K.value=K.__value="done",i(n),i(l);var D=t(l,2),L=t(r(D));w(()=>{h(),X(()=>{})});var O=r(L);O.value=O.__value="all";var S=t(O);S.value=S.__value="overdue";var I=t(S);I.value=I.__value="today";var N=t(I);N.value=N.__value="upcoming";var R=t(N);R.value=R.__value="none",i(L),i(D);var Q=t(D,2);ye(Q);var V=t(Q,2);i(s),i(a),w(v=>V.disabled=v,[()=>(b(),h(),F(),f(()=>b()==="all"&&h()==="all"&&!F().trim()))]),Y(n,b,v=>m(T,v)),Y(L,h,v=>m(U,v)),we(Q,F,v=>m(z,v)),G("click",V,()=>{m(T,"all"),m(U,"all"),m(z,"")}),p(e,a)};P(H,e=>{o(),de(M),f(()=>{var a;return((a=o())==null?void 0:a.user)&&M.url.pathname.startsWith("/projects/")})&&e(oe)})}var J=t(H,2),se=r(J);{var re=e=>{var a=$e(),s=q(a),l=r(s);i(s);var n=t(s,2);w(()=>be(l,`Logged in as ${o(),f(()=>o().user.email)??""}`)),G("click",n,te),p(e,a)},ie=e=>{var a=De();G("click",a,ae),p(e,a)};P(se,e=>{o(),f(()=>{var a;return(a=o())==null?void 0:a.user})?e(re):e(ie,!1)})}i(J),i(A);var le=t(A,2);{var ne=e=>{var a=Le();p(e,a)},ve=e=>{var a=ge(),s=q(a);he(s,j,"default",{}),p(e,a)};P(le,e=>{o(),f(()=>{var a;return!((a=o())!=null&&a.user)})?e(ne):e(ve,!1)})}p(Z,E),_e(),ee()}export{Re as component};
